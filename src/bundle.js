(()=>{"use strict";class e{#e;#t;#s=[];currentClickElement;#n=!1;#o=!1;constructor(e,t){this.boardsClass=e,this.openElementsClass=t,this.#l()}#l(){for(let e=0;e<this.openElementsClass.length;e++)this.#s.push(document.getElementsByClassName(this.openElementsClass[e]))}getBoards(){return document.getElementsByClassName(this.boardsClass)}enableBlur(){return this.#n=!0,this}enableBlockScroll(){return this.#o=!0,this}#i(e){let t=document.getElementById("blur-all");e?t.classList.add("blur-hidden"):t.classList.remove("blur-hidden")}display(){let e=this.getBoards();this.#r(this.#e);for(const t of this.#s)for(let s=0;s<t.length;s++)t[s].onclick=t=>{if(t.target.classList.length>1)for(const e of t.target.classList)this.openElementsClass.includes(e)&&t.stopPropagation();this.openElementsClass.includes(t.target.className)&&t.stopPropagation(),this.#o&&("hidden"===this.#a()?document.body.style.overflow="auto":document.body.style.overflow="hidden"),this.#n&&this.#i(!1),e[s].classList.toggle("pop-up-board-hidden"),this.currentClickElement=e[s],this.#r(this.#t)};for(const t of e)document.addEventListener("click",(e=>{if(e.target.classList.length>1)for(const t of e.target.classList)this.openElementsClass.includes(t)&&e.stopPropagation();for(const s of e.target.classList)s!==this.boardsClass&&(t.classList.add("pop-up-board-hidden"),this.#o&&(document.body.style.overflow="auto"),this.#n&&this.#i(!0));e.target!==t||this.openElementsClass.includes(e.target.className)||(t.classList.add("pop-up-board-hidden"),this.#o&&(document.body.style.overflow="auto"),this.#n&&this.#i(!0))}))}#a(){return getComputedStyle(document.body).overflow}#r(e){e&&e(this)}onDisplay(e){this.#e=e}onClick(e){this.#t=e}}function t(e){let t=document.getElementById("content").offsetWidth/2-e.offsetWidth/2;e.style.left=t+"px"}let s=new e("descr-board",["profile-description-span"]);function n(){document.getElementsByClassName("post-menu-btn")&&new e("post-menu-board",["post-menu-btn","post-menu-btn-img"]).display()}let o=new e("log-out-board",["log-out-menu-btn","log-out-menu-btn-img","log-out-menu-btn-text"]);function l(){let s=new e("post-delete-pop-up",["post-delete-btn"]);s.enableBlur().enableBlockScroll(),s.onClick((function(e){t(e.currentClickElement);let s=window.pageYOffset||document.documentElement.scrollTop;e.currentClickElement.style.top=s+200+"px"})),s.display()}function i(){let e=$(".post-like-btn");e.off("click"),e.on("click",(function(){let e=$(this).children(".like-btn-svg").children(".like-btn-path"),t=$(this).children(".value").html();e.hasClass("is-like")?$(this).children(".value").html(parseInt(t)-1):$(this).children(".value").html(parseInt(t)+1),e.toggleClass("is-like")}))}class r{#c;#d;#u=function(e){};constructor(e,t=""){this.#c=e,this.#d=t}run(){this.init_form()}on_submit(e){this.#u=e}init_form(){let e=this,t=$("."+this.#c);t.off("submit"),t.on("submit",(function(t){t.preventDefault();let s=$(this).serialize();s+="&is_ajax=1",$.ajax({url:e.#d,method:"POST",data:s,dataType:"json",success:function(t){e.#u(t)},error:function(e,t,s){console.log(s)}})}))}}let a=new r("subscription_form");function c(){let e=new r("post-like-form","http://localhost:8000/post-like");e.on_submit((function(e){console.log(e)})),e.run()}a.on_submit((function(e){e.error&&$("#form-error").html(e.error);let t=$("#profile-left-btn-sub");t.toggleClass("plb-gray"),t.hasClass("plb-gray")?t.html("Subscribed"):t.html("Subscribe")})),a.run();class d{#m;#h;target_element_id;data_fields;remove_target_id;insert_element_id;url;constructor(e,t,s,n,o=!1){this.target_element_id=e,this.data_fields=t,this.remove_target_id=o,this.url=s,this.insert_element_id=n,this.#_()}observer_start(e){let t=document.getElementById(this.target_element_id);t&&(this.#m&&this.#m.disconnect(),this.#m=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&e()}))})),this.#m.observe(t))}#f(){let e={};for(let t=0;t<this.data_fields.length;t++)e[this.data_fields[t]]=this.#h.data(this.data_fields[t]);return e}#g(e,t){$.ajax({url:e,method:"GET",data:this.#f(),success:e=>{t(e)},error:function(e,t,s){console.log(s)}})}#_(){this.#h=$(`#${this.target_element_id}`)}start(e){this.observer_start((()=>{this.#g(this.url,(t=>{this.display_response(t),this.#m.disconnect(),e(),this.remove_target_id&&this.#h.removeAttr("id"),this.#_(),this.start(e)}))}))}display_response(e){$(`#${this.insert_element_id}`).append(e)}close_observer(){this.#m.disconnect()}}class u extends d{constructor(e,t,s,n,o=!1){super(e,t,s,n,o)}display_response(e){$(`#${this.insert_element_id}`).prepend(e)}}function m(){let e=document.getElementById("chat-messages");if(!e)return;let t=document.getElementById("content"),s=document.getElementById("chat-header"),n=document.getElementById("chat-input"),o=t.offsetHeight-(s.offsetHeight+n.offsetHeight);e.style.height=o+"px"}function h(){let e=$("#chat-messages");if(!e)return;let t=e.children().last();e.scrollTop(t.offset().top-e.offset().top+e.scrollTop())}function _(){return"user_"+Math.floor(1e5*Math.random())}function f(){document.getElementById("auth-content")&&(document.getElementById("auth-content").style.left=window.innerWidth/2-parseInt(function(e,t){const s=document.getElementById("auth-content");return getComputedStyle(s).getPropertyValue("width")}())/2+"px")}m(),window.addEventListener("resize",m),$.ajax({url:"/server-data",method:"GET",data:{},dataType:"json",success:e=>{!function(e){switch(e.curr_url_pattern){case"/":new d("last-post",["last_post_id","user_id"],"/post-load-home","content",!0).start((function(){n(),i(),c(),l()}));break;case"/profile/{username}":new d("last-post",["last_post_id","user_id"],"/post-load","content",!0).start((function(){n(),i(),c(),l()}));break;case"/chat-room/{room_id}":let t=new u("chat-last-msg",["msg_id","chat_room_id"],"/load-msg","chat-messages",!0);t.start((function(){})),function(e,t){let s=_(),n=parseInt(function(e){let t=document.cookie.split(";");for(let e=0;e<t.length;e++){let s=t[e].trim();if(0===s.indexOf("UID="))return s.substring(4)}return null}());const o=new WebSocket("ws://localhost:50099");o.onopen=function(){const t={action:"join_room",room_id:e};o.send(JSON.stringify(t));const n={action:"generate_id",room_id:e,uid:s};o.send(JSON.stringify(n))},o.onmessage=function(n){const l=JSON.parse(n.data);switch(l.action){case"regenerate_id":s=_();const n={action:"generate_id",room_id:e,uid:s};o.send(JSON.stringify(n));break;case"send_msg":const i=document.getElementById("chat-messages"),r=l.uid===s;i.innerHTML+=r?`<div class="chat-message my-msg">${l.msg}</div>`:`<div class="chat-message">${l.msg}</div>`,h(),t()}},document.getElementById("send_btn").onclick=function(){const t=document.getElementById("chat-input-text"),l=t.value;if(!l)return;const i={action:"send_msg",room_id:e,uid:s,profile_user_id:n,msg:l};o.send(JSON.stringify(i)),t.value=""}}(e.room_id,(function(){t.close_observer(),new u("chat-last-msg",["msg_id","chat_room_id"],"/load-msg","chat-messages",!0).start((function(){}))})),h()}}(e)}}),f(),document.getElementsByClassName("profile-description")&&(s.enableBlockScroll().enableBlur(),s.onClick((function(e){t(e.currentClickElement)})),s.display()),n(),document.getElementsByClassName("log-out-menu-btn")&&(o.enableBlur().enableBlockScroll(),o.onClick((function(e){t(e.currentClickElement);let s=window.pageYOffset||document.documentElement.scrollTop;e.currentClickElement.style.top=s+200+"px"})),o.display()),l(),window.onresize=function(){s.currentClickElement&&t(s.currentClickElement),f(),o.currentClickElement&&t(o.currentClickElement)},$(".comment-answer-btn").on("click",(function(){$("#answer_id").val($(this).data("comment-id")),$(".answer-name").html("@"+$(this).data("comment-username")),$(".answer-name").css("display","block")})),$(".answer-name").on("click",(function(){$("#answer_id").val(""),$(this).css("display","none")})),c(),i()})();